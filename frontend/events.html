<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Eventi</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <button id="backBtn" class="back-btn">‚Üê Natrag</button>
            <h2 id="clubTitle"></h2>
        </div>
        <div id="eventCards" class="card-grid"></div>
    </div>

    <script>
        function checkUser() {
            if (!localStorage.getItem('username')) {
                window.location.href = '/index.html';
            }
        }

        const urlParams = new URLSearchParams(window.location.search);
        const clubId = urlParams.get('club_id');
        const clubName = urlParams.get('club_name');

        document.getElementById('clubTitle').textContent = `${clubName}`;
        document.getElementById('backBtn').onclick = () => window.location.href = '/clubs.html';

        function loadEvents() {
            fetch(`/api/clubs/${clubId}/events`)
                .then(r => r.json())
                .then(data => {
                    const eventCards = document.getElementById('eventCards');
                    eventCards.innerHTML = '';
                    if (!data.events || data.events.length === 0) {
                        eventCards.innerHTML = '<p style="grid-column: 1/-1; text-align: center;">Nema dostupnih evenata.</p>';
                        return;
                    }
                    data.events.forEach(ev => {
                        const card = document.createElement('div');
                        card.className = 'card';
                        card.onclick = () => {
                            window.location.href = `/buy-ticket.html?event_id=${ev.id}&event_name=${encodeURIComponent(ev.name)}&club_name=${encodeURIComponent(clubName)}`;
                        };

                        const title = document.createElement('div');
                        title.className = 'card-title';
                        title.textContent = ev.name;

                        const subtitle = document.createElement('div');
                        subtitle.className = 'card-subtitle';
                        subtitle.textContent = 'üìÖ ' + (ev.date || 'Datum: nepoznat');

                        const text = document.createElement('div');
                        text.className = 'card-text';
                        text.textContent = ev.description || 'Opis eventa...';

                        card.appendChild(title);
                        card.appendChild(subtitle);
                        card.appendChild(text);
                        eventCards.appendChild(card);
                    });
                });
        }

        checkUser();
        loadEvents();
    </script>
</body>
</html>
